# JunoYi 钧逸管理系统 - 项目架构说明

## 一、项目概述

JunoYi 是一个基于 Spring Boot 3.2 + MyBatis Plus 的企业级后台管理系统框架，采用 Maven 多模块架构设计，实现了依赖统一管理、模块化开发、易于扩展的特点。

**技术栈：**
- Java 21
- Spring Boot 3.2.0
- MyBatis Plus 3.5.5
- MySQL 8.0
- Maven 多模块

---

## 二、项目模块结构

```
JunoYi (根模块)
├── junoyi-dependencies      # 依赖管理模块 (统一版本控制)
├── junoyi-common           # 公共模块 (工具类、常量、枚举等)
├── junoyi-framework        # 框架核心封装模块
│   ├── junoyi-framework-core    # 核心功能封装
│   └── junoyi-framework-web     # Web相关封装
├── junoyi-module-api       # 功能模块API (对外接口定义)
│   └── junoyi-module-system-api # 系统模块API
│       ├── domain          # 领域对象
│       │   ├── entity      # 实体类 (数据库映射)
│       │   ├── vo          # 视图对象 (返回给前端)
│       │   └── bo          # 业务对象 (业务逻辑传输)
│       ├── service         # 服务接口定义
│       └── mapper          # 数据访问接口
├── junoyi-module           # 功能模块实现
│   └── junoyi-module-system     # 系统模块实现
│       ├── service.impl    # 服务实现
│       └── controller      # 控制器
└── junoyi-server           # 启动模块 (应用入口)
```

---

## 三、各模块详细说明

### 3.1 junoyi-dependencies (依赖管理模块)

**作用：** 统一管理整个项目的所有依赖版本，包括第三方库和内部模块。

**特点：**
- 所有版本号在此模块的 `<properties>` 中定义
- 通过 `<dependencyManagement>` 统一管理依赖版本
- 其他模块引用依赖时无需指定版本号

**配置示例：**
```xml
<properties>
    <spring.boot.version>3.2.0</spring.boot.version>
    <mybatis-plus.version>3.5.5</mybatis-plus.version>
    <!-- 更多版本定义... -->
</properties>

<dependencyManagement>
    <dependencies>
        <!-- 内部模块版本 -->
        <dependency>
            <groupId>cn.junoyi</groupId>
            <artifactId>junoyi-common</artifactId>
            <version>${revision}</version>
        </dependency>
        
        <!-- 第三方依赖版本 -->
        <dependency>
            <groupId>com.baomidou</groupId>
            <artifactId>mybatis-plus-boot-starter</artifactId>
            <version>${mybatis-plus.version}</version>
        </dependency>
    </dependencies>
</dependencyManagement>
```

---

### 3.2 junoyi-common (公共模块)

**作用：** 存放项目中通用的工具类、常量、枚举、异常定义等。

**建议目录结构：**
```
junoyi-common/
├── src/main/java/cn/junoyi/common/
│   ├── constant/      # 常量定义
│   ├── enums/         # 枚举类
│   ├── exception/     # 自定义异常
│   ├── utils/         # 工具类
│   └── annotation/    # 自定义注解
```

**使用场景：**
- 全局常量定义
- 通用工具方法
- 业务异常类
- 公共注解

---

### 3.3 junoyi-framework (框架核心封装模块)

**作用：** 对 Spring Boot、MyBatis Plus 等框架进行二次封装，提供统一的基础功能。

#### 3.3.1 junoyi-framework-core (核心功能)
- 统一返回结果封装 (Result)
- 统一异常处理 (GlobalExceptionHandler)
- 基础配置类
- 拦截器、过滤器

#### 3.3.2 junoyi-framework-web (Web功能)
- Web 相关配置
- 跨域配置
- 接口文档配置 (Knife4j)
- 安全认证配置 (JWT)

**建议目录结构：**
```
junoyi-framework-core/
├── src/main/java/cn/junoyi/framework/core/
│   ├── result/        # 统一返回结果
│   ├── exception/     # 全局异常处理
│   ├── config/        # 核心配置
│   └── interceptor/   # 拦截器

junoyi-framework-web/
├── src/main/java/cn/junoyi/framework/web/
│   ├── config/        # Web配置
│   ├── security/      # 安全配置
│   └── filter/        # 过滤器
```

---

### 3.4 junoyi-module-api (功能模块API)

**作用：** 定义各功能模块的对外接口、领域对象，实现接口与实现分离。

**目录结构：**
```
junoyi-module-system-api/
├── src/main/java/cn/junoyi/module/system/api/
│   ├── domain/
│   │   ├── entity/    # 实体类 (对应数据库表)
│   │   │   └── User.java
│   │   ├── vo/        # 视图对象 (返回给前端)
│   │   │   └── UserVO.java
│   │   └── bo/        # 业务对象 (业务逻辑传输)
│   │       └── UserBO.java
│   ├── service/       # 服务接口
│   │   └── IUserService.java
│   └── mapper/        # Mapper接口
│       └── UserMapper.java
```

**对象说明：**
- **Entity (实体类)：** 与数据库表一一对应，使用 MyBatis Plus 注解
- **VO (View Object)：** 返回给前端的数据对象，可能包含多表关联数据
- **BO (Business Object)：** 业务层使用的对象，用于复杂业务逻辑

---

### 3.5 junoyi-module (功能模块实现)

**作用：** 实现 module-api 中定义的接口，包含具体的业务逻辑。

**目录结构：**
```
junoyi-module-system/
├── src/main/java/cn/junoyi/module/system/
│   ├── controller/        # 控制器层
│   │   └── UserController.java
│   ├── service/
│   │   └── impl/          # 服务实现
│   │       └── UserServiceImpl.java
│   └── convert/           # 对象转换器 (MapStruct)
│       └── UserConvert.java
```

**依赖关系：**
- 依赖对应的 `module-api` 模块
- 依赖 `framework` 模块
- 依赖 `common` 模块

---

### 3.6 junoyi-server (启动模块)

**作用：** 应用程序的启动入口，聚合所有功能模块。

**目录结构：**
```
junoyi-server/
├── src/main/java/cn/junoyi/
│   └── JunoYiApplication.java    # 启动类
├── src/main/resources/
│   ├── application.yml            # 配置文件
│   ├── application-dev.yml        # 开发环境配置
│   └── application-prod.yml       # 生产环境配置
```

**pom.xml 配置：**
```xml
<dependencies>
    <!-- 引入需要的功能模块 -->
    <dependency>
        <groupId>cn.junoyi</groupId>
        <artifactId>junoyi-module-system</artifactId>
    </dependency>
    
    <!-- 引入框架核心 -->
    <dependency>
        <groupId>cn.junoyi</groupId>
        <artifactId>junoyi-framework-web</artifactId>
    </dependency>
</dependencies>
```

---

## 四、模块依赖关系图

```
junoyi-server
    ├── junoyi-module-system
    │   ├── junoyi-module-system-api
    │   ├── junoyi-framework-web
    │   │   └── junoyi-framework-core
    │   │       └── junoyi-common
    │   └── junoyi-common
    └── junoyi-framework-web
        └── junoyi-framework-core
            └── junoyi-common

所有模块都继承自根 pom.xml
所有模块的版本由 junoyi-dependencies 统一管理
```

---

## 五、版本管理机制

### 5.1 统一版本号

项目使用 `${revision}` 变量统一管理所有内部模块的版本号：

**根 pom.xml：**
```xml
<properties>
    <revision>1.0.0</revision>
</properties>
```

**子模块 pom.xml：**
```xml
<parent>
    <groupId>cn.junoyi</groupId>
    <artifactId>JunoYI</artifactId>
    <version>${revision}</version>
    <relativePath>../pom.xml</relativePath>
</parent>
```

### 5.2 版本扁平化

使用 `flatten-maven-plugin` 插件，在打包时将 `${revision}` 替换为实际版本号：

```xml
<plugin>
    <groupId>org.codehaus.mojo</groupId>
    <artifactId>flatten-maven-plugin</artifactId>
    <version>1.7.2</version>
</plugin>
```

### 5.3 修改版本号

**只需修改根 pom.xml 中的 `<revision>` 值，所有模块版本自动同步。**

```xml
<!-- 修改这里即可 -->
<properties>
    <revision>1.1.0</revision>
</properties>
```

---

## 六、GroupId 规范

为了保持项目结构清晰，所有模块统一使用 `cn.junoyi` 作为 groupId：

```xml
<groupId>cn.junoyi</groupId>
```

**包名规范：**
- common: `cn.junoyi.common`
- framework-core: `cn.junoyi.framework.core`
- framework-web: `cn.junoyi.framework.web`
- module-system-api: `cn.junoyi.module.system.api`
- module-system: `cn.junoyi.module.system`

---

## 七、常见问题

### Q1: 为什么要分 module 和 module-api？

**A:** 实现接口与实现分离，便于：
- 其他模块只依赖 API，不依赖具体实现
- 支持多种实现方式（如不同数据源）
- 提高代码可测试性

### Q2: 如何添加新的第三方依赖？

**A:** 
1. 在 `junoyi-dependencies/pom.xml` 的 `<properties>` 中定义版本号
2. 在 `<dependencyManagement>` 中添加依赖声明
3. 在需要的模块中引用（无需指定版本）

### Q3: 修改 Spring Boot 版本后需要做什么？

**A:**
1. 修改 `junoyi-dependencies/pom.xml` 中的 `spring.boot.version`
2. 检查其他依赖是否兼容新版本
3. 运行 `mvn clean install` 重新构建

---

## 八、最佳实践

### 8.1 依赖原则
- ✅ 在 `dependencies` 模块统一管理版本
- ✅ 子模块引用依赖时不指定版本
- ❌ 避免在子模块中硬编码版本号

### 8.2 模块职责
- ✅ common 只放通用工具，不依赖业务
- ✅ framework 只做框架封装，不包含业务逻辑
- ✅ module-api 只定义接口和领域对象
- ✅ module 实现具体业务逻辑

### 8.3 代码规范
- ✅ 使用 Lombok 简化代码
- ✅ 使用 MapStruct 进行对象转换
- ✅ 统一异常处理
- ✅ 统一返回结果格式

---

## 九、构建与运行

### 9.1 构建项目

```bash
# 在根目录执行
mvn clean install
```

### 9.2 运行项目

```bash
# 方式1: Maven 命令
cd junoyi-server
mvn spring-boot:run

# 方式2: 打包后运行
cd junoyi-server
mvn clean package
java -jar target/junoyi-server.jar
```

### 9.3 跳过测试

```bash
mvn clean install -DskipTests
```

---

## 十、项目信息

- **项目名称：** JunoYi 钧逸管理系统
- **当前版本：** 1.0.0
- **Java 版本：** 21
- **构建工具：** Maven 3.6+
- **官网：** https://junoyi.com/

---

**文档更新日期：** 2024-11-23
