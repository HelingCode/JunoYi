# 字典数据应用示例

本文档说明如何在JunoYi系统中使用字典数据,包括初始化数据、在代码中使用字典API、以及前端展示字典标签。

## 一、初始化字典数据

### 1.1 执行初始化SQL

字典初始化数据位于 `sql/MySQL/dict_init.sql`,包含以下字典类型:

- **sys_user_sex**: 用户性别(未设定/男/女)
- **sys_user_status**: 用户状态(停用/正常)
- **sys_dept_status**: 部门状态(停用/正常)
- **sys_role_status**: 角色状态(停用/正常)
- **sys_menu_status**: 菜单状态(停用/正常)
- **sys_menu_type**: 菜单类型(目录/菜单/按钮)
- **sys_common_status**: 通用状态(停用/正常)
- **sys_yes_no**: 是否选项(是/否)
- **sys_show_hide**: 显示隐藏(显示/隐藏)
- **sys_data_scope**: 数据范围(全部/自定义/本部门/本部门及以下/仅本人)
- **sys_login_type**: 登录类型(账号密码/企业微信/钉钉/飞书)
- **sys_device_type**: 设备类型(桌面端/移动端/平板)
- **sys_log_level**: 操作日志级别(信息/警告/错误)
- **sys_oper_type**: 操作类型(查看/新增/修改/删除/导出/导入)

执行SQL:
```bash
mysql -u root -p your_database < sql/MySQL/dict_init.sql
```

## 二、在代码中使用字典

### 2.1 使用字典常量类

系统提供了 `DictTypeConstants` 常量类,避免硬编码字典类型:

```java
import com.junoyi.system.constant.DictTypeConstants;

// 使用常量而不是硬编码字符串
String dictType = DictTypeConstants.SYS_USER_SEX;
```

### 2.2 在Service层使用字典API

在Service实现类中注入 `SysDictApi`,用于翻译字典值为标签:

```java
@Service
@RequiredArgsConstructor
public class SysUserServiceImpl implements ISysUserService {
    
    private final SysDictApi sysDictApi;
    
    @Override
    public PageResult<SysUserVO> getUserList(SysUserQueryDTO queryDTO, Page<SysUser> page) {
        // ... 查询用户数据
        List<SysUserVO> userVOList = sysUserConverter.toVoList(resultPage.getRecords());
        
        // 使用字典API翻译性别和状态标签
        for (SysUserVO userVO : userVOList) {
            if (userVO.getSex() != null) {
                userVO.setSexLabel(sysDictApi.getDictLabel(
                    DictTypeConstants.SYS_USER_SEX, 
                    userVO.getSex()
                ));
            }
            if (userVO.getStatus() != null) {
                userVO.setStatusLabel(sysDictApi.getDictLabel(
                    DictTypeConstants.SYS_USER_STATUS, 
                    String.valueOf(userVO.getStatus())
                ));
            }
        }
        
        return PageResult.of(userVOList, ...);
    }
}
```

### 2.3 VO类添加标签字段

在VO类中添加对应的标签字段,用于前端显示:

```java
@Data
public class SysUserVO {
    /**
     * 性别
     */
    private String sex;

    /**
     * 性别标签（字典翻译）
     */
    private String sexLabel;

    /**
     * 状态
     */
    private Integer status;

    /**
     * 状态标签（字典翻译）
     */
    private String statusLabel;
}
```

## 三、已应用字典的模块

### 3.1 用户管理 (SysUser)

- **性别字段**: `sex` → `sexLabel`
  - 字典类型: `sys_user_sex`
  - 值: 0=未设定, 1=男, 2=女

- **状态字段**: `status` → `statusLabel`
  - 字典类型: `sys_user_status`
  - 值: 0=停用, 1=正常

### 3.2 部门管理 (SysDept)

- **状态字段**: `status` → `statusLabel`
  - 字典类型: `sys_dept_status`
  - 值: 0=停用, 1=正常

### 3.3 角色管理 (SysRole)

- **状态字段**: `status` → `statusLabel`
  - 字典类型: `sys_role_status`
  - 值: 0=停用, 1=正常

- **数据范围字段**: `dataScope` → `dataScopeLabel`
  - 字典类型: `sys_data_scope`
  - 值: 1=全部数据, 2=自定义数据, 3=本部门数据, 4=本部门及以下数据, 5=仅本人数据

## 四、前端使用示例

前端可以直接使用返回的标签字段进行显示:

```typescript
// 用户列表显示
<template>
  <el-table :data="userList">
    <el-table-column prop="userName" label="用户名" />
    <el-table-column prop="sexLabel" label="性别" />
    <el-table-column prop="statusLabel" label="状态">
      <template #default="{ row }">
        <el-tag :type="row.status === 1 ? 'success' : 'danger'">
          {{ row.statusLabel }}
        </el-tag>
      </template>
    </el-table-column>
  </el-table>
</template>
```

## 五、扩展字典应用

如需在其他模块应用字典,按以下步骤操作:

### 5.1 在VO中添加标签字段

```java
@Data
public class YourEntityVO {
    private Integer status;
    private String statusLabel;  // 添加标签字段
}
```

### 5.2 在Service中注入并使用字典API

```java
@Service
@RequiredArgsConstructor
public class YourServiceImpl {
    private final SysDictApi sysDictApi;
    
    public List<YourEntityVO> getList() {
        List<YourEntityVO> list = ...;
        
        // 翻译字典标签
        for (YourEntityVO vo : list) {
            if (vo.getStatus() != null) {
                vo.setStatusLabel(sysDictApi.getDictLabel(
                    DictTypeConstants.SYS_COMMON_STATUS,
                    String.valueOf(vo.getStatus())
                ));
            }
        }
        
        return list;
    }
}
```

### 5.3 如需新增字典类型

1. 在数据库中添加字典类型和数据
2. 在 `DictTypeConstants` 中添加常量
3. 按上述步骤在代码中使用

## 六、字典API方法说明

`SysDictApi` 提供以下方法:

```java
// 根据字典类型获取所有字典数据
List<SysDictDataVO> getDictDataByType(String dictType);

// 根据字典类型和值获取标签
String getDictLabel(String dictType, String dictValue);

// 根据字典类型和标签获取值
String getDictValue(String dictType, String dictLabel);

// 检查字典数据是否存在
boolean existsDictData(String dictType, String dictValue);

// 批量查询多个字典类型的数据
Map<String, List<SysDictDataVO>> getDictDataByTypes(List<String> dictTypes);
```

详细使用说明请参考 `docs/字典API使用指南.md`。

## 七、注意事项

1. **字典值类型**: 数据库中字典值为字符串类型,如果实体字段是整型,需要转换:
   ```java
   String.valueOf(intValue)
   ```

2. **空值处理**: 使用字典API前先判空,避免空指针异常

3. **性能优化**: 字典数据会被缓存,频繁调用不会影响性能

4. **只返回启用数据**: 字典API只返回 `status='0'` 的启用数据

5. **前端缓存**: 前端可以调用字典接口缓存常用字典数据,减少请求次数
