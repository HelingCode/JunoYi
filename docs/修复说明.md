# JunoYi 项目修复说明

## 修复时间
2024-11-23

---

## 一、修复的主要问题

### 1.1 版本管理问题
**问题描述：**
- 根 pom.xml 使用 `${revision}` 变量
- 部分子模块使用硬编码版本号 `1.0.0`
- 版本不统一导致依赖管理混乱

**修复方案：**
- 统一所有子模块使用 `${revision}` 变量
- 在根 pom.xml 中定义 `<revision>1.0.0</revision>`
- 使用 flatten-maven-plugin 在打包时替换版本号

### 1.2 relativePath 配置错误
**问题描述：**
- 多个子模块的 `<relativePath>` 设置为 `./pom.xml`
- 正确应该是 `../pom.xml`（指向父目录的 pom.xml）

**修复方案：**
- 修改所有子模块的 relativePath 为 `../pom.xml`

### 1.3 GroupId 不统一
**问题描述：**
- 不同模块使用了不同的 groupId
  - `cn.junoyi.module.system`
  - `cn.junoyi.framework`
  - `cn.junoyi.system`

**修复方案：**
- 统一所有模块使用 `cn.junoyi` 作为 groupId
- 通过 artifactId 区分不同模块

### 1.4 dependencies 模块不完整
**问题描述：**
- junoyi-dependencies 模块缺少对内部模块的版本管理
- 缺少常用第三方依赖的版本定义
- 未继承父 pom

**修复方案：**
- 添加 parent 引用
- 完善内部模块的版本管理
- 添加常用第三方依赖（MyBatis Plus、Druid、Hutool等）

---

## 二、具体修复内容

### 2.1 修复的文件清单

| 文件路径 | 修复内容 |
|---------|---------|
| `junoyi-common/pom.xml` | 版本号改为 ${revision}，添加 relativePath |
| `junoyi-framework/pom.xml` | 修复 relativePath |
| `junoyi-framework/junoyi-framework-core/pom.xml` | 修复 parent 引用，移除多余 groupId |
| `junoyi-framework/junoyi-framework-web/pom.xml` | 修复 parent 引用，移除多余 groupId |
| `junoyi-module/pom.xml` | 修复 relativePath，移除错误的 groupId |
| `junoyi-module/junoyi-module-system/pom.xml` | 修复 parent 引用，移除多余 groupId |
| `junoyi-module-api/pom.xml` | 修复 relativePath |
| `junoyi-module-api/junoyi-module-system-api/pom.xml` | 修复 parent 引用，移除多余 groupId |
| `junoyi-server/pom.xml` | 修复 relativePath，修正依赖引用，添加打包插件 |
| `junoyi-dependencies/pom.xml` | 完全重构，添加完整的依赖管理 |

### 2.2 junoyi-dependencies 模块重构

**新增的版本管理：**

```xml
<properties>
    <!-- 框架版本 -->
    <spring.boot.version>3.2.0</spring.boot.version>
    
    <!-- 数据库相关 -->
    <mybatis-plus.version>3.5.5</mybatis-plus.version>
    <druid.version>1.2.20</druid.version>
    <mysql.version>8.0.33</mysql.version>
    
    <!-- 工具类 -->
    <lombok.version>1.18.30</lombok.version>
    <hutool.version>5.8.23</hutool.version>
    <fastjson2.version>2.0.43</fastjson2.version>
    <mapstruct.version>1.5.5.Final</mapstruct.version>
    
    <!-- 其他 -->
    <knife4j.version>4.3.0</knife4j.version>
    <jwt.version>0.12.3</jwt.version>
</properties>
```

**新增的内部模块管理：**
- junoyi-common
- junoyi-framework-core
- junoyi-framework-web
- junoyi-module-system-api
- junoyi-module-system

**新增的第三方依赖管理：**
- Spring Boot Dependencies
- MyBatis Plus
- Druid 连接池
- MySQL 驱动
- Lombok
- Hutool 工具类
- FastJson2
- Knife4j 接口文档
- JWT 认证
- MapStruct 对象转换

### 2.3 junoyi-server 模块优化

**修复的依赖引用：**

修复前：
```xml
<dependency>
    <groupId>cn.junoyi.module.system</groupId>
    <artifactId>junoyi-module</artifactId>
</dependency>
```

修复后：
```xml
<dependency>
    <groupId>cn.junoyi</groupId>
    <artifactId>junoyi-module-system</artifactId>
</dependency>

<dependency>
    <groupId>cn.junoyi</groupId>
    <artifactId>junoyi-framework-web</artifactId>
</dependency>
```

**新增打包插件：**
```xml
<build>
    <finalName>${project.artifactId}</finalName>
    <plugins>
        <plugin>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-maven-plugin</artifactId>
            <version>${spring.boot.version}</version>
        </plugin>
    </plugins>
</build>
```

---

## 三、修复后的项目结构

```
JunoYi (根模块 - cn.junoyi:JunoYI:${revision})
│
├── junoyi-dependencies (cn.junoyi:junoyi-dependencies:${revision})
│   └── 统一管理所有依赖版本
│
├── junoyi-common (cn.junoyi:junoyi-common:${revision})
│   └── 公共工具类
│
├── junoyi-framework (cn.junoyi:junoyi-framework:${revision})
│   ├── junoyi-framework-core (cn.junoyi:junoyi-framework-core:${revision})
│   └── junoyi-framework-web (cn.junoyi:junoyi-framework-web:${revision})
│
├── junoyi-module-api (cn.junoyi:junoyi-module-api:${revision})
│   └── junoyi-module-system-api (cn.junoyi:junoyi-module-system-api:${revision})
│
├── junoyi-module (cn.junoyi:junoyi-module:${revision})
│   └── junoyi-module-system (cn.junoyi:junoyi-module-system:${revision})
│
└── junoyi-server (cn.junoyi:junoyi-server:${revision})
    └── 应用启动入口
```

---

## 四、版本管理机制

### 4.1 统一版本控制

**根 pom.xml：**
```xml
<properties>
    <revision>1.0.0</revision>
</properties>
```

**所有子模块：**
```xml
<parent>
    <groupId>cn.junoyi</groupId>
    <artifactId>父模块ID</artifactId>
    <version>${revision}</version>
    <relativePath>../pom.xml</relativePath>
</parent>
```

### 4.2 依赖版本管理

**根 pom.xml 导入 dependencies：**
```xml
<dependencyManagement>
    <dependencies>
        <dependency>
            <groupId>cn.junoyi</groupId>
            <artifactId>junoyi-dependencies</artifactId>
            <version>${revision}</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
    </dependencies>
</dependencyManagement>
```

**子模块引用依赖（无需指定版本）：**
```xml
<dependency>
    <groupId>cn.junoyi</groupId>
    <artifactId>junoyi-common</artifactId>
    <!-- 版本由 dependencies 模块统一管理 -->
</dependency>
```

---

## 五、模块依赖关系

### 5.1 依赖层次

```
junoyi-server
    ↓
junoyi-module-system
    ↓
junoyi-module-system-api + junoyi-framework-web
    ↓
junoyi-framework-core
    ↓
junoyi-common
```

### 5.2 依赖规则

✅ **正确的依赖：**
- module → module-api
- module → framework-web
- module-api → common
- framework-web → framework-core
- server → module

❌ **禁止的依赖：**
- module-api → framework
- module-a → module-b（实现模块互相依赖）
- 循环依赖

---

## 六、如何使用修复后的项目

### 6.1 构建项目

```bash
# 在根目录执行
cd /Users/fanzijian/WorkSpace/JunoYi
mvn clean install
```

### 6.2 修改版本号

只需修改根 pom.xml：
```xml
<properties>
    <revision>1.1.0</revision>  <!-- 修改这里 -->
</properties>
```

### 6.3 添加新的第三方依赖

1. 在 `junoyi-dependencies/pom.xml` 中定义版本：
```xml
<properties>
    <新依赖.version>x.x.x</新依赖.version>
</properties>
```

2. 在 `<dependencyManagement>` 中声明：
```xml
<dependency>
    <groupId>xxx</groupId>
    <artifactId>xxx</artifactId>
    <version>${新依赖.version}</version>
</dependency>
```

3. 在需要的模块中引用（不指定版本）：
```xml
<dependency>
    <groupId>xxx</groupId>
    <artifactId>xxx</artifactId>
</dependency>
```

### 6.4 创建新模块

参考 `docs/模块开发指南.md` 中的详细步骤。

---

## 七、技术栈升级

### 7.1 Spring Boot 版本

从未明确 → **3.2.0**

**注意事项：**
- Spring Boot 3.x 要求 Java 17+（项目使用 Java 21）
- 包名从 `javax.*` 改为 `jakarta.*`
- 需要检查所有依赖的兼容性

### 7.2 新增的依赖

| 依赖 | 版本 | 用途 |
|-----|------|------|
| MyBatis Plus | 3.5.5 | ORM 框架 |
| Druid | 1.2.20 | 数据库连接池 |
| Hutool | 5.8.23 | Java 工具类库 |
| FastJson2 | 2.0.43 | JSON 处理 |
| Knife4j | 4.3.0 | 接口文档 |
| JWT | 0.12.3 | 认证授权 |
| MapStruct | 1.5.5.Final | 对象映射 |

---

## 八、文档说明

修复后创建了以下文档：

1. **项目架构说明.md**
   - 项目概述
   - 模块结构详解
   - 版本管理机制
   - 最佳实践

2. **模块开发指南.md**
   - 创建新模块的完整步骤
   - 模块引用关联规则
   - 代码示例
   - 常见问题解答

3. **快速参考.md**
   - 项目结构速查
   - POM 配置速查
   - Maven 命令速查
   - 代码模板速查

4. **修复说明.md**（本文档）
   - 修复的问题说明
   - 具体修复内容
   - 使用指南

---

## 九、验证清单

修复完成后，请验证以下内容：

- [ ] 所有模块的 parent 引用正确
- [ ] 所有模块的 relativePath 为 `../pom.xml`
- [ ] 所有模块使用 `${revision}` 版本号
- [ ] 所有模块的 groupId 统一为 `cn.junoyi`
- [ ] dependencies 模块包含所有内部模块的版本管理
- [ ] 执行 `mvn clean install` 成功
- [ ] 项目可以正常启动

---

## 十、后续建议

### 10.1 立即要做的
1. 执行 `mvn clean install` 验证项目构建
2. 检查是否有编译错误
3. 补充缺失的代码文件

### 10.2 可以考虑的优化
1. 在 common 模块下创建子模块（core、redis、security等）
2. 在 framework-core 中添加统一返回结果类
3. 在 framework-web 中添加全局异常处理
4. 创建代码生成器模板
5. 添加单元测试

### 10.3 注意事项
1. 升级依赖版本前先测试兼容性
2. 新增模块必须在 dependencies 中注册
3. 保持依赖关系清晰，避免循环依赖
4. 定期更新文档

---

## 十一、联系方式

如有问题，请查阅：
- `docs/项目架构说明.md` - 了解项目整体架构
- `docs/模块开发指南.md` - 学习如何开发新模块
- `docs/快速参考.md` - 快速查找常用配置和命令

---

**修复完成日期：** 2024-11-23  
**修复人员：** Cascade AI  
**项目版本：** 1.0.0
