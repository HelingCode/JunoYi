# ==================== Spring 配置 ====================
spring:
  # ==================== 数据源配置 ====================
  datasource:
    dynamic:
      primary: master
      strict: true
      # 数据源列表
      datasource:
        # 主库配置
        master:
          driver-class-name: com.mysql.cj.jdbc.Driver
          url: jdbc:mysql://localhost:3306/junoyi?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai&useSSL=false&allowPublicKeyRetrieval=true&rewriteBatchedStatements=true
          username: root
          password: 123456
      
      # ==================== Druid 连接池配置 ====================
      druid:
        # 基础连接池配置
        initial-size: 5
        min-idle: 5
        max-active: 20
        max-wait: 60000
        
        # 连接检测配置
        time-between-eviction-runs-millis: 60000
        min-evictable-idle-time-millis: 300000
        max-evictable-idle-time-millis: 900000
        validation-query: SELECT 1
        validation-query-timeout: 3
        test-while-idle: true
        test-on-borrow: false
        test-on-return: false
        
        # 连接泄漏检测
        remove-abandoned: true
        remove-abandoned-timeout: 1800
        log-abandoned: true
        
        # 监控统计配置
        filters: stat,wall,slf4j
        use-global-data-source-stat: true
        connection-properties: druid.stat.slowSqlMillis=3000;druid.stat.logSlowSql=true
        
        # Druid 监控页面
        stat-view-servlet:
          enabled: true
          url-pattern: /druid/*
          login-username: admin
          login-password: admin123
          reset-enable: true
        
        # Web 统计过滤器
        web-stat-filter:
          enabled: true
          url-pattern: /*
          exclusions: "*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*"
          session-stat-enable: true
          session-stat-max-count: 1000
        
        # AOP 监控
        aop-patterns: com.junoyi.module.*.service.*
        
        # SQL 防火墙
        wall:
          enabled: true
          config:
            multi-statement-allow: true
            none-base-statement-allow: true
            update-where-none-check: true
            delete-where-none-check: true

  # ==================== Redis 配置 ====================
  data:
    redis:
      host: 127.0.0.1
      port: 6379
      database: 2
      timeout: 10s
      # password: 123456

# ==================== Redisson 配置 ====================
redisson:
  keyPrefix:
  threads: 4
  nettyThreads: 8
  singleServerConfig:
    clientName: junoyi-local
    connectionMinimumIdleSize: 8
    connectionPoolSize: 32
    idleConnectionTimeout: 10000
    timeout: 3000
    subscriptionConnectionPoolSize: 50

# ==================== MyBatis Plus 配置 ====================
mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.slf4j.Slf4jImpl
  
  global-config:
    db-config:
      id-type: auto
      logic-delete-field: deleted
      logic-delete-value: 1
      logic-not-delete-value: 0

